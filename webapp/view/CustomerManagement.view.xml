<mvc:View
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:layout="sap.ui.layout"
  xmlns:core="sap.ui.core"
  xmlns="sap.m"
  xmlns:f="sap.f"
  xmlns:grid="sap.ui.layout.cssgrid"
  controllerName="csrdreporting.controller.CustomerManagement"
  height="100%">
  <Page showFooter="true" showNavButton="true" navButtonPress="navBack">
    <content>
      <layout:FixFlex class="fixFlexVertical">
        <layout:fixContent>
          <ObjectHeader title="{i18n>Management_Title}" backgroundDesign="Solid" condensed="true">
            <ObjectAttribute text="Manage the customers and filled questionnaires." />
          </ObjectHeader>
        </layout:fixContent>
        <layout:flexContent>
          <!--
          The master view, showing the list of all customers.
          -->
          <SplitContainer id="splitContainer" initialDetail="placeholder" initialMaster="master">
            <masterPages>
              <Page id="master" title="Customers" backgroundDesign="List">
                <headerContent>
                  <Button icon="sap-icon://add" tooltip="Add Customer" press="onCustomerAddPress" />
                </headerContent>
                <List items="{svc>/CustomerSet}">
                  <CustomListItem type="Active" press="onCustomerPress">
                    <HBox class="sapUiSmallMargin" alignItems="Center">
                      <core:Icon size="2rem" src="sap-icon://person-placeholder" class="sapUiSmallMarginBeginEnd" />
                      <VBox class="sapUiSmallMarginBegin">
                        <layoutData>
                          <FlexItemData growFactor="1" />
                        </layoutData>
                        <Text text="{svc>Name}" />
                        <Label text="{svc>CustomerCode}" />
                      </VBox>
                      <HBox alignItems="Center">
                        <Button
                          icon="sap-icon://edit"
                          type="Transparent"
                          tooltip="Edit Customer"
                          press=".onCustomerEditPress"
                        />
                        <Button
                          icon="sap-icon://decline"
                          type="Transparent"
                          tooltip="Delete Customer"
                          press="onCustomerDeletePress"
                        />
                      </HBox>
                    </HBox>
                  </CustomListItem>
                </List>

                <!--
                Dialog for editing and creating a new customer.
                -->
                <Dialog id="customerDialog" title="{state>/customerDialogTitle}" draggable="true">
                  <content>
                    <VBox class="sapUiMediumMargin">
                      <Label text="{i18n>Management_DialogCustomerName}" required="true" />
                      <Input id="customerName" value="{state>/customerName}" required="true" />
                      <Label text="{i18n>Management_DialogCustomerCode}" required="true" />
                      <Input id="customerCode" value="{state>/customerCode}" required="true" />
                    </VBox>
                  </content>
                  <beginButton>
                    <Button
                      text="{i18n>Management_SubmitCustomer}"
                      press="onCustomerDialogSubmit"
                      type="Emphasized"
                      enabled="{= !!${state>/customerName} &amp;&amp; !!${state>/customerCode} &amp;&amp; !${state>/submitCustomerMutation/isPending} }"
                    />
                  </beginButton>
                  <endButton>
                    <Button text="{i18n>Management_CancelCustomerDialog}" press="onCustomerDialogCancel" />
                  </endButton>
                </Dialog>
              </Page>
            </masterPages>

            <detailPages>
              <!--
              Details page showing the filled questionnaires/form schema results of the currently selected customer.
              -->
              <Page
                id="details"
                title="Questionnaires"
                busy="{state>/customerFormSchemasQuery/isPending}"
                busyIndicatorDelay="0">
                <Panel backgroundDesign="Transparent">
                  <f:GridList id="gridList" items="{state>/customerFormSchemasQuery/data}" showNoData="false">
                    <f:customLayout>
                      <grid:GridBasicLayout gridTemplateColumns="repeat(auto-fit, 23rem)" gridGap="1rem" />
                    </f:customLayout>
                    <f:GridListItem type="Active" press="onFormSchemaResultPress">
                      <VBox class="sapUiSmallMargin">
                        <HBox>
                          <core:Icon size="4rem" src="sap-icon://documents" class="sapUiSmallMargin" />
                          <VBox alignItems="Start" justifyContent="Center" width="100%">
                            <Title text="CSRD" level="H1" />
                            <Label text="Filled on: {path: 'state>UpdatedAt', type: 'sap.ui.model.type.DateTime'}" />
                          </VBox>
                          <Button
                            icon="sap-icon://decline"
                            type="Transparent"
                            tooltip="Delete Questionnaire"
                            press=".onQuestionnaireDeletePress"
                          />
                        </HBox>
                      </VBox>
                    </f:GridListItem>
                  </f:GridList>
                </Panel>
              </Page>
            </detailPages>
          </SplitContainer>
        </layout:flexContent>
      </layout:FixFlex>
    </content>
  </Page>
</mvc:View>
