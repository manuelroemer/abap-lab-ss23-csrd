<mvc:View
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:layout="sap.ui.layout"
  xmlns:core="sap.ui.core"
  xmlns="sap.m"
  xmlns:f="sap.f"
  xmlns:grid="sap.ui.layout.cssgrid"
  controllerName="csrdreporting.controller.CustomerManagement"
  height="100%">
  <Page showFooter="true" showNavButton="true" navButtonPress="navBack">
    <content>
      <layout:FixFlex class="fixFlexVertical">
        <layout:fixContent>
          <ObjectHeader title="{i18n>CustomerManagement_Title}" backgroundDesign="Solid" condensed="true">
            <ObjectAttribute text="Manage the customers and filled questionnaires." />
          </ObjectHeader>
        </layout:fixContent>
        <layout:flexContent>
          <!--
          The master view, showing the list of all customers.
          -->
          <SplitContainer id="splitContainer" initialDetail="placeholder" initialMaster="master">
            <masterPages>
              <Page
                id="master"
                title="Customers"
                backgroundDesign="List"
                busy="{state>/deleteCustomerMutation/isPending}"
                busyIndicatorDelay="0">
                <headerContent>
                  <Button icon="sap-icon://add" tooltip="Add Customer" press="onCustomerAddPress" />
                </headerContent>
                <List items="{svc>/CustomerSet}" width="auto">
                  <CustomListItem type="Active" press="onCustomerPress">
                    <HBox class="sapUiSmallMargin" alignItems="Center">
                      <core:Icon size="2rem" src="sap-icon://person-placeholder" class="sapUiSmallMarginBeginEnd" />
                      <VBox class="sapUiSmallMarginBegin">
                        <layoutData>
                          <FlexItemData growFactor="1" />
                        </layoutData>
                        <Text text="{svc>Name}" wrapping="true" />
                        <Label text="{svc>CustomerCode}" wrapping="true" />
                      </VBox>
                      <HBox alignItems="Center">
                        <Button
                          icon="sap-icon://edit"
                          type="Transparent"
                          tooltip="Edit Customer"
                          press=".onCustomerEditPress"
                        />
                        <Button
                          icon="sap-icon://decline"
                          type="Transparent"
                          tooltip="Delete Customer"
                          press="onCustomerDeletePress"
                        />
                      </HBox>
                    </HBox>
                  </CustomListItem>
                </List>

                <!--
                Dialog for editing and creating a new customer.
                -->
                <Dialog id="customerDialog" title="{state>/customerDialogTitle}" draggable="true">
                  <content>
                    <VBox class="sapUiMediumMargin">
                      <Label text="{i18n>CustomerManagement_DialogCustomerName}" required="true" />
                      <Input
                        id="customerName"
                        value="{state>/customerName}"
                        required="true"
                        placeholder="Capgemini"
                        maxLength="255"
                      />
                      <Label
                        text="{i18n>CustomerManagement_DialogCustomerCode}"
                        required="true"
                        class="sapUiSmallMarginTop"
                      />
                      <Input
                        id="customerCode"
                        value="{state>/customerCode}"
                        required="true"
                        placeholder="customer-123"
                        maxLength="255"
                      />
                      <Label text="{i18n>CustomerManagement_DialogCustomerNotes}" class="sapUiSmallMarginTop" />
                      <TextArea
                        id="customerNotes"
                        value="{state>/notes}"
                        placeholder="Notes"
                        maxLength="255"
                        width="100%"
                      />
                    </VBox>
                  </content>
                  <beginButton>
                    <Button
                      text="{i18n>CustomerManagement_SubmitCustomer}"
                      press="onCustomerDialogSubmit"
                      type="Emphasized"
                      enabled="{= !!${state>/customerName} &amp;&amp; !!${state>/customerCode} &amp;&amp; !${state>/submitCustomerMutation/isPending} }"
                    />
                  </beginButton>
                  <endButton>
                    <Button text="{i18n>CustomerManagement_CancelCustomerDialog}" press="onCustomerDialogCancel" />
                  </endButton>
                </Dialog>
              </Page>
            </masterPages>

            <detailPages>
              <!--
              Details page showing the filled questionnaires/form schema results of the currently selected customer.
              -->
              <Page
                id="details"
                title="Questionnaires"
                busy="{= ${state>/customerFormSchemaResultsQuery/isPending} || ${state>/deleteFormSchemaResultMutation/isPending}}"
                busyIndicatorDelay="0"
                class="myBackgroundStyle">
                <headerContent>
                  <Button icon="sap-icon://add" tooltip="Add Questionnaire" press="onQuestionnaireAddPress" />
                </headerContent>
                <Panel backgroundDesign="Transparent">
                  <f:GridList id="gridList" items="{state>/customerFormSchemaResultsQuery/data}" showNoData="false">
                    <f:customLayout>
                      <grid:GridBasicLayout gridTemplateColumns="repeat(auto-fit, 23rem)" gridGap="2rem" />
                    </f:customLayout>
                    <f:GridListItem type="Active" press="onFormSchemaResultPress">
                      <VBox class="sapUiSmallMargin">
                        <HBox>
                          <core:Icon size="4rem" src="sap-icon://documents" class="sapUiSmallMargin" />
                          <VBox alignItems="Start" justifyContent="Center" width="100%">
                            <HBox>
                              <Title text="{state>Name}" level="H1" />
                              <ObjectStatus
                                class="sapUiTinyMarginBegin"
                                text="Draft"
                                inverted="true"
                                state="Information"
                                visible="{state>IsDraft}"
                              />
                            </HBox>
                            <Label text="Filled on: {path: 'state>UpdatedAt', type: 'sap.ui.model.type.DateTime'}" />
                          </VBox>
                          <Button
                            icon="sap-icon://decline"
                            type="Transparent"
                            tooltip="Delete Questionnaire"
                            press=".onQuestionnaireDeletePress"
                          />
                        </HBox>
                      </VBox>
                    </f:GridListItem>
                  </f:GridList>
                </Panel>
                <SelectDialog
                  id="customerSelectDialog"
                  noDataText="No Customers Found"
                  title="{i18n>CustomerManagement_SelectDialogCustomer}"
                  search="onSearch"
                  confirm="onDialogClose"
                  cancel="onDialogClose"
                  draggable="true"
                  contentHeight="auto"
                  contentWidth="auto"
                  items="{svc>/CustomerSet}">
                  <StandardListItem
                    title="{svc>Name}"
                    description="{svc>CustomerCode}"
                    icon="sap-icon://person-placeholder"
                    iconDensityAware="false"
                    iconInset="false"
                    type="Active"
                    class="sapUiTinyMarginBegin sapUiTinyMarginEnd"
                  />
                </SelectDialog>
              </Page>
            </detailPages>
          </SplitContainer>
        </layout:flexContent>
      </layout:FixFlex>
    </content>
  </Page>
</mvc:View>
